name: test-package-install
on:
  pull_request:
    paths:
      - 'packages/**/*.pacscript'
jobs:
  run-pacstall-install-for-package:
    runs-on: ubuntu-latest
    container: twilightblood/pacstall:latest
    steps:
      - id: checkout
        uses: actions/checkout@v2
      - id: files
        uses: jitterbit/get-changed-files@v1
      - name: Installing pacstall
        run: sudo bash -c "$(wget -q https://git.io/JsADh -O -)"
      - name: Installing packages with pacstall
        run: | 
          install() {
          pacscript_file=$(basename "${changed_file}")
          package_name="$(basename $pacscript_file | cut -f1 -d".")"
          package_dir=$(dirname "${changed_file}")
          echo "Running pacstall -I for ${package_name}..."
          echo "pacstall -Il ${package_name}"
          cd ${package_dir}
          pacstall -PIl ${package_name}
          }
          for changed_file in packagelist packages/opentoonz/opentoonz.pacscript; do
          set -- [*].pacscript *.pacscript
          case "$1$2" in
            ('[*].pacscript*.pacscript') ;;
            (*) shift; install "$@"
          esac

          done

        env:
          TERM: xterm 
          
